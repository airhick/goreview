<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - GoReview</title>
    <meta name="description" content="Contactez l'équipe GoReview pour toute question sur nos plaques NFC">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <a href="/" class="nav-logo">
                    <img src="logo.png" alt="GoReview Logo" class="logo-img" style="height:38px;width:auto;margin-right:10px;vertical-align:middle;">
                    <span class="logo-text">GoReview</span>
                </a>
                <div class="nav-actions">
                    <a href="/" class="btn-secondary">Retour à l'accueil</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contact Section -->
    <section class="section-padding" style="padding-top: calc(var(--spacing-xl) + 80px);">
        <div class="container">
            <div class="section-header">
                <h1 class="section-title-large">Contactez-nous</h1>
                <p class="section-description">Une question sur nos plaques NFC ? Un besoin spécifique ? Notre équipe vous répond dans les plus brefs délais.</p>
            </div>
            
            <div style="max-width: 700px; margin: 0 auto;">
                <!-- Contact Form -->
                <div class="checkout-card">
                    <form class="checkout-form" id="contact-form" novalidate>
                        <div class="form-group">
                            <label for="contact-email">Adresse e-mail <span class="required">*</span></label>
                            <input type="email" id="contact-email" name="email" placeholder="votre.email@exemple.com" autocomplete="email" required>
                        </div>

                        <div class="form-group">
                            <label for="contact-message">Votre message <span class="required">*</span></label>
                            <textarea id="contact-message" name="message" rows="6" placeholder="Décrivez votre demande..." required></textarea>
                        </div>

                        <div class="form-feedback" id="contact-status" hidden></div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary large" id="submit-contact">Envoyer le message</button>
                        </div>
                        <p class="form-hint"><span class="required">*</span> Champs obligatoires</p>
                    </form>

                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h4>Pages</h4>
                    <a href="/">Accueil</a>
                    <a href="/cart.html">Panier</a>
                    <a href="/contact.html">Contact</a>
                </div>
                <div class="footer-column">
                    <h4>Informations</h4>
                    <a href="/politique-confidentialite.html">Politique de confidentialité</a>
                    <a href="/conditions-generales.html">Conditions générales</a>
                    <a href="/politique-cookies.html">Politique de cookies</a>
                </div>
                <div class="footer-column">
                    <h4>Contact</h4>
                    <a href="mailto:goreview.fr@gmail.com">Email : goreview.fr@gmail.com</a>
                    <a href="/contact.html">Formulaire de contact</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2024 GoReview. Tous droits réservés. | <a href="mailto:goreview.fr@gmail.com" class="footer-email">goreview.fr@gmail.com</a></p>
        </div>
    </div>
    </footer>

    <script>
        const contactForm = document.getElementById('contact-form');
        const contactStatus = document.getElementById('contact-status');
        const submitButton = document.getElementById('submit-contact');

        const setContactStatus = (message, type = 'info') => {
            if (!contactStatus) return;
            if (!message) {
                contactStatus.hidden = true;
                contactStatus.textContent = '';
                contactStatus.classList.remove('is-error', 'is-success', 'is-info');
                return;
            }

            contactStatus.hidden = false;
            contactStatus.textContent = message;
            contactStatus.classList.remove('is-error', 'is-success', 'is-info');
            if (type === 'error') {
                contactStatus.classList.add('is-error');
            } else if (type === 'success') {
                contactStatus.classList.add('is-success');
            } else {
                contactStatus.classList.add('is-info');
            }
        };

        const toggleFormLoading = (isLoading) => {
            if (!submitButton) return;
            submitButton.disabled = isLoading;
            if (isLoading) {
                submitButton.dataset.originalText = submitButton.textContent;
                submitButton.textContent = 'Envoi en cours...';
            } else if (submitButton.dataset.originalText) {
                submitButton.textContent = submitButton.dataset.originalText;
                delete submitButton.dataset.originalText;
            }
        };

        const highlightFieldError = (fieldId) => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.classList.add('field-error');
                field.focus();
                field.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        };

        const clearFieldErrors = () => {
            if (!contactForm) return;
            const fields = contactForm.querySelectorAll('.field-error');
            fields.forEach(field => {
                field.classList.remove('field-error');
            });
        };

        const sendContactToWebhook = async (data) => {
            const webhookUrl = 'https://n8n.goreview.fr/webhook/contact';
            
            const response = await fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                const errorText = await response.text().catch(() => null);
                throw new Error(errorText || `Erreur ${response.status}`);
            }

            // Flexible response validation
            let responseData;
            try {
                responseData = await response.json();
            } catch (e) {
                // If JSON parsing fails, assume success if status is OK
                return { status: 'success' };
            }

            return responseData;
        };

        if (contactForm) {
            contactForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                clearFieldErrors();

                if (!contactForm.reportValidity()) {
                    return;
                }

                const formData = new FormData(contactForm);
                const email = (formData.get('email') || '').toString().trim();
                const message = (formData.get('message') || '').toString().trim();

                // Validate email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!email || !emailRegex.test(email)) {
                    setContactStatus('Veuillez entrer une adresse email valide.', 'error');
                    highlightFieldError('contact-email');
                    return;
                }

                // Validate message
                if (!message || message.length < 10) {
                    setContactStatus('Votre message doit contenir au moins 10 caractères.', 'error');
                    highlightFieldError('contact-message');
                    return;
                }

                const payload = {
                    email,
                    message,
                    timestamp: new Date().toISOString(),
                    source: 'contact-page'
                };

                try {
                    setContactStatus('Envoi de votre message...', 'info');
                    toggleFormLoading(true);
                    await sendContactToWebhook(payload);
                    
                    // Show success state
                    setContactStatus('Message envoyé avec succès.', 'success');
                    contactForm.reset();
                } catch (error) {
                    console.error('Erreur lors de l\'envoi du message', error);
                    setContactStatus('Impossible d\'envoyer le message. Merci de réessayer ou de nous contacter directement par email.', 'error');
                } finally {
                    toggleFormLoading(false);
                }
            });

            // Clear field errors on input
            const nameInput = document.getElementById('contact-name');
            const emailInput = document.getElementById('contact-email');
            const messageTextarea = document.getElementById('contact-message');

            if (nameInput) {
                nameInput.addEventListener('input', () => {
                    nameInput.classList.remove('field-error');
                });
            }

            if (emailInput) {
                emailInput.addEventListener('input', () => {
                    emailInput.classList.remove('field-error');
                });
            }

            if (messageTextarea) {
                messageTextarea.addEventListener('input', () => {
                    messageTextarea.classList.remove('field-error');
                });
            }
        }
    </script>
</body>
</html>
