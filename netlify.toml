# Netlify configuration file
[build]
  # No build command needed for static site
  publish = "."

[build.environment]
  # Environment variables can be set in Netlify dashboard
  # SUPABASE_URL and SUPABASE_ANON_KEY should be set in Netlify dashboard

# Redirect rules
[[redirects]]
  from = "/dashboard"
  to = "/dashboard.html"
  status = 200
  force = false

[[redirects]]
  from = "/config"
  to = "/config.html"
  status = 200
  force = false

[[redirects]]
  from = "/config/"
  to = "/config.html"
  status = 200
  force = false

# Handle config with query params (id parameter)
[[redirects]]
  from = "/config/*"
  to = "/config.html"
  status = 200
  force = false

# Create account page
[[redirects]]
  from = "/create"
  to = "/create.html"
  status = 200
  force = false

[[redirects]]
  from = "/create/"
  to = "/create.html"
  status = 200
  force = false

[[redirects]]
  from = "/create/*"
  to = "/create.html"
  status = 200
  force = false

# Company page (Google Sign-In)
[[redirects]]
  from = "/company"
  to = "/company.html"
  status = 200
  force = false

[[redirects]]
  from = "/company/"
  to = "/company.html"
  status = 200
  force = false

[[redirects]]
  from = "/company/*"
  to = "/company.html"
  status = 200
  force = false

# Pages/Bienvenue - welcome page before configuration
[[redirects]]
  from = "/pages/bienvenue"
  to = "/pages/bienvenue/index.html"
  status = 200
  force = false

[[redirects]]
  from = "/pages/bienvenue/"
  to = "/pages/bienvenue/index.html"
  status = 200
  force = false

[[redirects]]
  from = "/pages/bienvenue/*"
  to = "/pages/bienvenue/index.html"
  status = 200
  force = false

# Pages/Configuration - serve the configuration page directly (no redirect)
# The page will handle the webhook call and redirect based on webhook response
[[redirects]]
  from = "/pages/configuration"
  to = "/pages/configuration/index.html"
  status = 200
  force = false

[[redirects]]
  from = "/pages/configuration/"
  to = "/pages/configuration/index.html"
  status = 200
  force = false

[[redirects]]
  from = "/pages/configuration/*"
  to = "/pages/configuration/index.html"
  status = 200
  force = false

# Cart page
[[redirects]]
  from = "/cart"
  to = "/cart.html"
  status = 200
  force = false

[[redirects]]
  from = "/cart/"
  to = "/cart.html"
  status = 200
  force = false

# Confirmation page
[[redirects]]
  from = "/confirmation"
  to = "/confirmation.html"
  status = 200
  force = false

[[redirects]]
  from = "/confirmation/"
  to = "/confirmation.html"
  status = 200
  force = false

# SPA fallback (if needed in future)
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Cache static assets
[[headers]]
  for = "/styles.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/script.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.webp"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# HTML files should not be cached
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

